<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">
<!--
`drag-and-drop-behavior` is a Polymer behavior to enable drag and drop on hierarchy items.

@group dude Behaviors
@behavior drag-and-drop-behavior
@demo demo/index.html
-->
<script>
    DudeDragAndDropBehavior = {
        properties: {

            _opacity: {
                type: Number,
                value: undefined
            },

            _currentTracking: {
                type: Object,
                value: null
            }
        },

        listeners: {
            "track": "_onTrack"
        },

        _getRecursiveElement: function (element, type) {
            if (element.tagName === type) {
                return element;
            }
            var parentElement = element.parentElement;
            if (parentElement !== null) {
                return this._getRecursiveElement(parentElement, type);
            }
            return null;
        },

        _onTrack: function (event) {
            event.stopPropagation();
            var hover = null;
            switch (event.detail.state) {
                case "track":
                    this.style.opacity = 0.5;
                    hover = event.detail.hover();
                    hover = this._getRecursiveElement(hover, "DUDE-HIERARCHY-ITEM");
                    if (hover === null || hover === this) {
                        return;
                    }
                    if (this._currentTracking != hover) {
                        if (this._currentTracking != null) {
                            this.fire("undrag-over", {on: this._currentTracking});
                        }
                        this._currentTracking = hover;
                        this.fire("drag-over", {on: this._currentTracking});
                    }
                    break;
                case "end":
                    this.style.opacity = 1.0;
                    hover = event.detail.hover();
                    hover = this._getRecursiveElement(hover, "DUDE-HIERARCHY-ITEM");
                    if (hover === null || hover === this) {
                        return;
                    }
                    this.fire("dropped", {on:hover});
                    break;
            }
        },

    };
</script>